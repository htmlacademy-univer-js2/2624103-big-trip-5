!function(){"use strict";var e={10:function(e,t,n){var s=n(537),i=n.n(s),r=n(645),o=n.n(r)()(i());o.push([e.id,".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n","",{version:3,sources:["webpack://./src/framework/view/abstract-view.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,WAAW;AACb;;AAEA;EACE;;IAEE,wBAAwB;EAC1B;;EAEA;;;;;IAKE,2BAA2B;EAC7B;;EAEA;;;;IAIE,0BAA0B;EAC5B;AACF",sourcesContent:[".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n"],sourceRoot:""}]),t.Z=o},645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",s=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),s&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),s&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,s,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);s&&o[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},537:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),r="/*# ".concat(i," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},379:function(e){var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var r={},o=[],a=0;a<e.length;a++){var l=e[a],d=s.base?l[0]+s.base:l[0],c=r[d]||0,h="".concat(d," ").concat(c);r[d]=c+1;var v=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==v)t[v].references++,t[v].updater(u);else{var p=i(u,s);s.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=s(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=n(r[o]);t[a].references--}for(var l=s(e,i),d=0;d<r.length;d++){var c=n(r[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=l}}},569:function(e){var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,i&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,exports:{}};return e[s](r,r.exports,n),r.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nc=void 0,function(){var e=n(379),t=n.n(e),s=n(795),i=n.n(s),r=n(569),o=n.n(r),a=n(565),l=n.n(a),d=n(216),c=n.n(d),h=n(589),v=n.n(h),u=n(10),p={};p.styleTagTransform=v(),p.setAttributes=l(),p.insert=o().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=c(),t()(u.Z,p),u.Z&&u.Z.locals&&u.Z.locals;const m="shake";class f{#e=null;constructor(){if(new.target===f)throw new Error("Can't instantiate AbstractView, only concrete one.")}get element(){return this.#e||(this.#e=function(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}(this.template)),this.#e}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#e=null}shake(e){this.element.classList.add(m),setTimeout((()=>{this.element.classList.remove(m),e?.()}),600)}}class _ extends f{constructor(e,t){super(),this._filters=e,this._currentFilter=t}get template(){return`\n      <form class="trip-filters" action="#" method="get">\n        ${this._filters.map((e=>`\n          <div class="trip-filters__filter">\n            <input \n              id="filter-${e.type}" \n              class="trip-filters__filter-input visually-hidden" \n              type="radio" \n              name="trip-filter" \n              value="${e.type}"\n              ${e.type===this._currentFilter?"checked":""}\n              ${0===e.count?"disabled":""}\n            >\n            <label class="trip-filters__filter-label" for="filter-${e.type}">\n              ${e.name} ${e.count>0?`(${e.count})`:""}\n            </label>\n          </div>\n        `)).join("")}\n      </form>\n    `}}const E={DAY:"day",TIME:"time",PRICE:"price"};class g extends f{constructor(e){super(),this._currentSortType=e,this._callback={}}get template(){return`\n      <form class="trip-events__trip-sort trip-sort" action="#" method="get">\n        ${Object.entries(E).map((e=>{let[t,n]=e;return`\n          <div class="trip-sort__item trip-sort__item--${n}">\n            <input \n              id="sort-${n}" \n              class="trip-sort__input visually-hidden" \n              type="radio" \n              name="trip-sort" \n              value="${n}"\n              ${this._currentSortType===n?"checked":""}\n              data-sort-type="${n}"\n            >\n            <label class="trip-sort__btn" for="sort-${n}">${t}</label>\n          </div>\n        `})).join("")}\n      </form>\n    `}setSortTypeChangeHandler(e){this._callback.sortTypeChange=e,this.element.addEventListener("click",this.#t)}#t=e=>{if("INPUT"!==e.target.tagName)return;e.preventDefault();const t=e.target.dataset.sortType;this._callback.sortTypeChange(t)}}class y extends f{_state={};updateElement(e){e&&(this._setState(e),this.#n())}_restoreHandlers(){throw new Error("Abstract method not implemented: restoreHandlers")}_setState(e){this._state=structuredClone({...this._state,...e})}#n(){const e=this.element,t=e.parentElement;this.removeElement();const n=this.element;t.replaceChild(n,e),this._restoreHandlers()}}const C=["taxi","bus","train","ship","drive","flight","check-in","sightseeing","restaurant"],b={type:"flight",destination:"geneva",dateFrom:new Date,dateTo:new Date(Date.now()+36e5),basePrice:100,offers:[1,2],isFavorite:!1},w=e=>{if(e instanceof Date)return isNaN(e.getTime())?null:e;const t=new Date(e);return isNaN(t.getTime())?null:t},k=e=>{const t=w(e);return t?t.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A"},M=e=>{const t=w(e);return t?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"N/A"};class D extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;super(),this._state=D.parseEventToState(e),this._destinationsModel=t,this._offersModel=n,this._callback={submit:()=>{},close:()=>{},delete:()=>{}},this.#s()}static parseEventToState(e){return{...e,isDisabled:!1,isSaving:!1,isDeleting:!1}}static parseStateToEvent(e){const t={...e};return delete t.isDisabled,delete t.isSaving,delete t.isDeleting,t}get template(){const{type:e,destination:t,dateFrom:n,dateTo:s,basePrice:i,offers:r}=this._state,o=this._destinationsModel.getDestinationById(t),a=this._offersModel.getOffersByType(e);return`\n      <li class="trip-events__item">\n        <form class="event event--edit" action="#" method="post">\n          <header class="event__header">\n            \x3c!-- Поле выбора типа --\x3e\n            <div class="event__type-wrapper">\n              <label class="event__type event__type-btn" for="event-type-toggle">\n                <span class="visually-hidden">Choose event type</span>\n                <img class="event__type-icon" width="17" height="17" src="img/icons/${e}.png" alt="Event type icon">\n              </label>\n              <input class="event__type-toggle visually-hidden" id="event-type-toggle" type="checkbox">\n              <div class="event__type-list">\n                <fieldset class="event__type-group">\n                  <legend class="visually-hidden">Event type</legend>\n                  ${C.map((t=>`\n                    <div class="event__type-item">\n                      <input id="event-type-${t}" class="event__type-input visually-hidden" \n                        type="radio" name="event-type" value="${t}" ${e===t?"checked":""}>\n                      <label class="event__type-label event__type-label--${t}" for="event-type-${t}">\n                        ${t}\n                      </label>\n                    </div>\n                  `)).join("")}\n                </fieldset>\n              </div>\n            </div>\n\n            \x3c!-- Поле выбора пункта назначения --\x3e\n            <div class="event__field-group event__field-group--destination">\n              <label class="event__label event__type-output" for="event-destination">\n                ${e}\n              </label>\n              <input class="event__input event__input--destination" id="event-destination" \n                type="text" name="event-destination" value="${o?.name||""}" \n                list="destination-list" required>\n              <datalist id="destination-list">\n                ${this._destinationsModel.getDestinations().map((e=>`\n                  <option value="${e.name}"></option>\n                `)).join("")}\n              </datalist>\n            </div>\n\n            \x3c!-- Даты --\x3e\n            <div class="event__field-group event__field-group--time">\n              <label class="visually-hidden" for="event-start-time">From</label>\n              <input class="event__input event__input--time" id="event-start-time" \n                type="text" name="event-start-time" value="${k(n)} ${M(n)}" required>\n              &mdash;\n              <label class="visually-hidden" for="event-end-time">To</label>\n              <input class="event__input event__input--time" id="event-end-time" \n                type="text" name="event-end-time" value="${k(s)} ${M(s)}" required>\n            </div>\n\n            \x3c!-- Цена --\x3e\n            <div class="event__field-group event__field-group--price">\n              <label class="event__label" for="event-price">\n                <span class="visually-hidden">Price</span>\n                &euro;\n              </label>\n              <input class="event__input event__input--price" id="event-price" \n                type="number" name="event-price" value="${i}" min="1" required>\n            </div>\n\n            \x3c!-- Кнопки --\x3e\n            <button class="event__save-btn btn btn--blue" type="submit">Save</button>\n            <button class="event__reset-btn" type="reset">Delete</button>\n            <button class="event__rollup-btn" type="button">\n              <span class="visually-hidden">Close event</span>\n            </button>\n          </header>\n\n          \x3c!-- Детали --\x3e\n          <section class="event__details">\n            \x3c!-- Офферы --\x3e\n            ${a.length>0?`\n              <section class="event__section event__section--offers">\n                <h3 class="event__section-title event__section-title--offers">Offers</h3>\n                <div class="event__available-offers">\n                  ${a.map((e=>`\n                    <div class="event__offer-selector">\n                      <input class="event__offer-checkbox visually-hidden" id="event-offer-${e.id}" \n                        type="checkbox" name="event-offer" value="${e.id}" \n                        ${r.includes(e.id)?"checked":""}>\n                      <label class="event__offer-label" for="event-offer-${e.id}">\n                        <span class="event__offer-title">${e.title}</span>\n                        +€&nbsp;<span class="event__offer-price">${e.price}</span>\n                      </label>\n                    </div>\n                  `)).join("")}\n                </div>\n              </section>\n            `:""}\n\n            \x3c!-- Описание пункта назначения --\x3e\n            ${o?.description?`\n              <section class="event__section event__section--destination">\n                <h3 class="event__section-title event__section-title--destination">Destination</h3>\n                <p class="event__destination-description">${o.description}</p>\n                \n                ${o.pictures?.length>0?`\n                  <div class="event__photos-container">\n                    ${o.pictures.map((e=>`\n                      <img class="event__photo" src="${e.src}" alt="${e.description}">\n                    `)).join("")}\n                  </div>\n                `:""}\n              </section>\n            `:""}\n          </section>\n        </form>\n      </li>\n    `}_restoreHandlers(){this.#s()}#s(){this.element.querySelector(".event__type-list").addEventListener("change",this.#i),this.element.querySelector(".event__input--destination").addEventListener("change",this.#r),this.element.querySelector('[name="event-start-time"]').addEventListener("change",this.#o),this.element.querySelector('[name="event-end-time"]').addEventListener("change",this.#a),this.element.querySelector(".event__input--price").addEventListener("change",this.#l),this.element.querySelectorAll(".event__offer-checkbox").forEach((e=>{e.addEventListener("change",this.#d)})),this.element.querySelector(".event__save-btn").addEventListener("click",this.#c),this.element.querySelector(".event__reset-btn").addEventListener("click",this.#h),this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#v),document.addEventListener("keydown",this.#u)}#i=e=>{"INPUT"===e.target.tagName&&this.updateElement({type:e.target.value,offers:[]})};#o=e=>{this.updateElement({dateFrom:new Date(e.target.value)})};#a=e=>{this.updateElement({dateTo:new Date(e.target.value)})};#l=e=>{this.updateElement({basePrice:parseInt(e.target.value,10)})};#d=e=>{const t=parseInt(e.target.value,10),n=this._state.offers.includes(t)?this._state.offers.filter((e=>e!==t)):[...this._state.offers,t];this.updateElement({offers:n})};#c=e=>{if(e.preventDefault(),!this.#p())return;const t=this.#m();this._callback.submit(t)};#p(){const{destination:e,basePrice:t,dateFrom:n,dateTo:s}=this._state;return!(!this._destinationsModel.getDestinationById(e)||t<=0||isNaN(t)||s<=n)}#m(){const e={...this._state},t=this._destinationsModel.getDestinationById(e.destination);return{...e,destination:t.id,offers:e.offers.map((e=>e.id||e))}}#r=e=>{const t=this._destinationsModel.getDestinations().find((t=>t.name===e.target.value));t&&this.updateElement({destination:t.id})};#f=e=>{e.preventDefault(),this._callback.close&&this._callback.close()};#h=e=>{e.preventDefault(),this._callback.delete(this._state.id)};#u=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),e.stopPropagation(),this.#v(e))};#v=e=>{e?.preventDefault(),this._callback.close(),document.removeEventListener("keydown",this.#u)};setCloseHandler(e){return this._callback.close=e,this}setSubmitHandler(e){return this._callback.submit=e,this}setDeleteHandler(e){return this._callback.delete=e,this}removeElement(){document.removeEventListener("keydown",this.#u),super.removeElement()}}class T extends f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this._events=e,this._destinations=t,this._offers=n}get template(){if(!this._events.length)return'<div class="trip-info"></div>';const e=[...this._events].sort(((e,t)=>new Date(e.dateFrom)-new Date(t.dateFrom))),t=e[0].dateFrom,n=e[e.length-1].dateTo;return`\n      <section class="trip-main__trip-info trip-info">\n        <div class="trip-info__main">\n          <h1 class="trip-info__title">${function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e.length||!t.length)return"No destinations";const n=[...new Set(e.map((e=>{return n=e.destination,t.find((e=>e.id===n))?.name||"Unknown";var n})).filter(Boolean))];return n.length?n.length<=3?n.join(" — "):`${n[0]} — ... — ${n[n.length-1]}`:"No valid destinations"}(e,this._destinations)}</h1>\n          <p class="trip-info__dates">${((e,t)=>{try{const n=new Date(e),s=new Date(t);if(isNaN(n.getTime()))throw new Error("Invalid start date");if(isNaN(s.getTime()))throw new Error("Invalid end date");const i=k(n),r=k(s);return i===r?`${i}, ${M(n)} – ${M(s)}`:`${i} – ${r}`}catch(e){return"N/A"}})(t,n)}</p>\n        </div>\n        <p class="trip-info__cost">\n          Total: &euro;&nbsp;<span class="trip-info__cost-value">\n            ${function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length?e.reduce(((e,n)=>{const s=t.find((e=>e.type===n.type))?.offers||[],i=(n.offers||[]).reduce(((e,t)=>{const n=s.find((e=>e.id===t));return e+(n?.price||0)}),0);return e+(n.basePrice||0)+i}),0):0}(this._events,this._offers)}\n          </span>\n        </p>\n      </section>\n    `}}class $ extends f{constructor(e){let{onClick:t,isDisabled:n=!1}=e;super(),this._onClick=t,this._isDisabled=n,this.element.addEventListener("click",this._clickHandler)}get template(){return`\n      <button \n        class="trip-main__event-add-btn btn btn--big btn--yellow" \n        type="button"\n        ${this._isDisabled?"disabled":""}\n      >\n        <span class="visually-hidden">New event</span>New event\n      </button>\n    `}_clickHandler=e=>{e.preventDefault(),this._onClick()};setDisabled(e){this._isDisabled=e,this.element.disabled=e}}class F extends f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"everything";super(),this._filterType=e}get template(){return`<p class="trip-events__msg">${{everything:"Click New Event to create your first point",future:"There are no future events now",past:"There are no past events now",present:"There are no present events now"}[this._filterType]}</p>`}}class S extends y{constructor(e){let{event:t,destinationsModel:n,offersModel:s,onEditClick:i,onFavoriteClick:r}=e;super(),this._state={...t},this._destinationsModel=n,this._offersModel=s,this._callback={rollupClick:i,favoriteClick:r},this.#s()}get template(){const{type:e,destination:t,dateFrom:n,dateTo:s,basePrice:i,isFavorite:r}=this._state,o="object"==typeof t?t:this._destinationsModel.getDestinationById(t);if(!o)return'<div class="error">Invalid destination</div>';const a=this._offersModel.getOffersByType(e).filter((e=>this._state.offers.includes(e.id)));return`\n      <li class="trip-events__item">\n        <div class="event">\n          <time class="event__date" datetime="${n.toISOString()}">${k(n)}</time>\n          <div class="event__type">\n            <img class="event__type-icon" width="42" height="42" \n                 src="img/icons/${e}.png" alt="Event type icon">\n          </div>\n          <h3 class="event__title">${e} ${o.name}</h3>\n          \n          <div class="event__schedule">\n            <p class="event__time">\n              <time datetime="${n.toISOString()}">${M(n)}</time>\n              &mdash;\n              <time datetime="${s.toISOString()}">${M(s)}</time>\n            </p>\n            <p class="event__duration">${((e,t)=>{const n=w(e),s=w(t);if(!n||!s)return"N/A";const i=s-n,r=Math.floor(i/864e5),o=Math.floor(i%864e5/36e5),a=Math.floor(i%36e5/6e4);return r>0?`${r}D ${o}H ${a}M`:o>0?`${o}H ${a}M`:`${a}M`})(n,s)}</p>\n          </div>\n          \n          <p class="event__price">\n            &euro;&nbsp;<span class="event__price-value">${i}</span>\n          </p>\n          \n          ${a.length>0?`\n            <h4 class="visually-hidden">Offers:</h4>\n            <ul class="event__selected-offers">\n              ${a.map((e=>`\n                <li class="event__offer">\n                  <span class="event__offer-title">${e.title}</span>\n                  &plus;&euro;&nbsp;\n                  <span class="event__offer-price">${e.price}</span>\n                </li>\n              `)).join("")}\n            </ul>\n          `:""}\n          \n          <button class="event__favorite-btn ${r?"event__favorite-btn--active":""}" type="button">\n            <span class="visually-hidden">Add to favorite</span>\n            <svg class="event__favorite-icon" width="28" height="28" viewBox="0 0 28 28">\n              <path d="M14 21l-8.22899 4.3262 1.57159-9.1631L.685209 9.67376 9.8855 8.33688 14 0l4.1145 8.33688 9.2003 1.33688-6.6574 6.48934 1.5716 9.1631L14 21z"/>\n            </svg>\n          </button>\n          \n          <button class="event__rollup-btn" type="button">\n            <span class="visually-hidden">Open event</span>\n          </button>\n        </div>\n      </li>\n    `}#s(){const e=this.element.querySelector(".event__rollup-btn"),t=this.element.querySelector(".event__favorite-btn");e&&t&&(e.addEventListener("click",this.#f),t.addEventListener("click",this.#_))}_restoreHandlers(){this.#s()}#_=e=>{e.preventDefault(),"function"==typeof this._callback.favoriteClick&&this._callback.favoriteClick({...this._state,isFavorite:!this._state.isFavorite})};#f=e=>{e.preventDefault(),this._callback.rollupClick()};setFavoriteClickHandler(e){const t=this.element.querySelector(".event__favorite-btn");t&&(t.removeEventListener("click",this.#_),this._callback.favoriteClick=e,t.addEventListener("click",this.#_))}setRollupClickHandler(e){const t=this.element.querySelector(".event__rollup-btn");t&&(t.removeEventListener("click",this.#f),this._callback.rollupClick=e,t.addEventListener("click",this.#f))}setEditClickHandler(e){return this._callback.editClick=e,this}}function H(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"beforeend";if(!(e instanceof f))throw new Error("Can render only components");if(null===t)throw new Error("Container element doesn't exist");t.insertAdjacentElement(n,e.element)}function A(e,t){const n=t.element.parentElement;if(!n)throw new Error("Can't replace unexisting parent");n.replaceChild(e.element,t.element),t.removeElement()}function x(e){if(null!=e){if(!(e instanceof f))throw new Error("Can remove only components");e.removeElement()}}class L{#E=null;#g=null;#y=null;#C=null;#b=null;#w=null;#k=null;#M=null;#D="DEFAULT";#T=!1;constructor(e){let{container:t,destinationsModel:n,offersModel:s,onDataChange:i,onModeChange:r}=e;if(!t)throw new Error("Container not provided");this.#C=t,this.#b=n,this.#w=s,this.#k=i,this.#M=r}init(e){this.#E=e;const t=this.#g,n=this.#y;this.#g=new S({event:this.#E,destinationsModel:this.#b,offersModel:this.#w,onEditClick:this.#$,onFavoriteClick:this.#F}),this.#y=new D(this.#E,this.#b,this.#w),this.#y.setSubmitHandler(this.#S),this.#y.setDeleteHandler(this.#H),this.#y.setCloseHandler(this.#A),null===t||null===n?H(this.#g,this.#C):("DEFAULT"===this.#D&&A(this.#g,t),"EDITING"===this.#D&&A(this.#y,n)),this.#g.setRollupClickHandler(this.#$),this.#g.setFavoriteClickHandler(this.#F),x(t),x(n)}destroy(){x(this.#g),x(this.#y)}resetView(){this.#T&&this.#x()}#L=()=>{const e=this.#g.element;this.#y=new D(this.#E,this.#b,this.#w),this.#y.setSubmitHandler(this.#S),this.#y.setDeleteHandler(this.#H),this.#y.setCloseHandler(this.#A),e.replaceWith(this.#y.element),document.addEventListener("keydown",this.#u),this.#D="EDITING",this.#T=!0};#x=()=>{if(this.#T&&this.#y){const e=new S({event:this.#E,destinationsModel:this.#b,offersModel:this.#w,onEditClick:this.#$,onFavoriteClick:this.#F});this.#y.element.replaceWith(e.element),this.#g=e,document.removeEventListener("keydown",this.#u),this.#D="DEFAULT",this.#T=!1,this.#y=null}};#u=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),e.stopPropagation(),this.#A())};#$=()=>{this.#L()};isEditFormOpen(){return"EDITING"===this.#D}#F=e=>{this.#k(e)};#S=e=>{if(!e.destination)return void this.#y.shake();const t=this.#b.getDestinationById(e.destination);if(!t)return void this.#y.shake();const n={...this.#E,...e,destination:t.id};this.#k(n),this.#x()};#H=e=>{this.#k(e,!0)};#A=()=>{this.#x()}}class B{#B=null;#I=null;#b=null;#w=null;#N=null;#O=null;#P=(()=>new Map)();#q="day";#j=null;#K=null;#U=null;#R=null;#X=null;#G=null;#V=!1;constructor(e,t,n,s){if(!e.eventsContainer||!e.mainContainer)throw new Error("Containers not provided");this.#N=e.eventsContainer,this.#O=e.mainContainer,this.#I=t,this.#b=n,this.#w=s}init(){this.#W(),this.#Z(),this.#z(),this.#J(),this.#Y()}#Q(e){const t=this.#N.querySelector(".trip-events__list");if(!t)return;const n=new L({container:t,destinationsModel:this.#b,offersModel:this.#w,onDataChange:this.#ee,onModeChange:this.#M});n.init(e),this.#P.set(e.id,n)}#J(){const e=this.#N.querySelector(".trip-events__list");if(!e)return;e.innerHTML="";const t=this.#te();0!==t.length?t.forEach((e=>{this.#Q(e)})):H(new F,e)}#W(){const e=this.#I.getEvents(),t=this.#b.getDestinations();this.#j=new T(e,t);const n=this.#O.querySelector(".trip-main__trip-info");n&&(n.innerHTML="",H(this.#j,n))}#Y(){this.#R&&(x(this.#R),this.#R=null),this.#R=new $({onClick:this.#ne}),H(this.#R,this.#O)}#Z(){const e=this.#N.querySelector(".trip-controls__filters");if(!e)return;e.innerHTML="";const t=[{type:"everything",name:"Everything",count:this.#I.getEvents().length},{type:"future",name:"Future",count:this.#I.getFutureEvents().length},{type:"past",name:"Past",count:this.#I.getPastEvents().length}];this.#K=new _(t,"everything"),H(this.#K,e)}#z(){const e=this.#N.querySelector(".trip-events__trip-sort");e&&(e.innerHTML="",this.#U=new g(this.#q),this.#U.setSortTypeChangeHandler(this.#se),H(this.#U,e))}#ie(){this.#P.forEach((e=>e.destroy())),this.#P.clear();const e=this.#N.querySelector(".trip-events__list");e&&(e.innerHTML="")}#te(){switch(this.#q){case"time":return this.#I.getEventsSortedByTime();case"price":return this.#I.getEventsSortedByPrice();default:return this.#I.getEventsSortedByDay()}}#ee=(()=>{var e=this;return function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.#I.deleteEvent(t):e.#I.updateEvent(t);const n=e.#P.get(t.id);n&&n.init(t)}})();#M=()=>{this.#P.forEach((e=>e.resetView()))};#se=e=>{this.#q!==e&&(this.#q=e,this.#ie(),this.#J())};#ne=()=>{this.#P.forEach((e=>e.resetView()));const e=this.#N.querySelector(".trip-events__list");e&&(this.#V=!0,this.#R.setDisabled(!0),this.#B=new D(b,this.#b,this.#w),this.#B.setCloseHandler((()=>this.#re())),this.#B.setSubmitHandler((e=>{this.#I.addEvent(e),this.#re()})),e.prepend(this.#B.element),document.addEventListener("keydown",this.#u))};#u=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),this.#V?this.#re():this.#P.forEach((e=>{e.isEditFormOpen()&&e.resetView()})))};#re=()=>{this.#B&&(this.#B.removeElement(),this.#B=null,this.#V=!1,document.removeEventListener("keydown",this.#u),this.#R.setDisabled(!1),this.#J())};#x(){this.#X&&this.#G&&(A(this.#X,this.#G),document.removeEventListener("keydown",this.#u),this.#G=null,this.#X=null,this.#J())}}class I{constructor(){this._events=[],this._destinationsModel=null,this._offersModel=null}setEvents(e){this._events=e.map((e=>({...e,dateFrom:new Date(e.dateFrom),dateTo:new Date(e.dateTo)})))}setDestinationsModel(e){this._destinationsModel=e}setOffersModel(e){this._offersModel=e}getEvents(){return this._events.map((e=>{const t=this._destinationsModel.getDestinationById(e.destination);return t?{...e,destination:t,offers:this._offersModel.getOffersByType(e.type).filter((t=>e.offers.includes(t.id)))}:null})).filter(Boolean)}addEvent(e){this._events=[...this._events,e]}updateEvent(e){this._events=this._events.map((t=>t.id===e.id?{...e}:t))}deleteEvent(e){this._events=this._events.filter((t=>t.id!==e))}getFutureEvents(){const e=new Date;return this.getEvents().filter((t=>new Date(t.dateFrom)>e))}getPastEvents(){const e=new Date;return this.getEvents().filter((t=>new Date(t.dateTo)<e))}getPresentEvents(){const e=new Date;return this.getEvents().filter((t=>new Date(t.dateFrom)<=e&&new Date(t.dateTo)>=e))}getEventsSortedByDay(){return[...this.getEvents()].sort(((e,t)=>e.dateFrom-t.dateFrom))}getEventsSortedByTime(){return[...this.getEvents()].sort(((e,t)=>{const n=e.dateTo-e.dateFrom;return t.dateTo-t.dateFrom-n}))}getEventsSortedByPrice(){return[...this.getEvents()].sort(((e,t)=>t.basePrice-e.basePrice))}}class N{constructor(){this._destinations=[]}getDestinations(){return this._destinations}getDestinationById(e){return this._destinations.find((t=>t.id===e))}setDestinations(e){this._destinations=e}}class O{constructor(){this._offers=[]}getOffers(){return this._offers}getOffersByType(e){const t=this._offers.find((t=>t.type===e));return t?t.offers:[]}setOffers(e){this._offers=e}}const P=[{name:"Amsterdam",keywords:["canal","bikes","museum"]},{name:"Geneva",keywords:["lake","fountain","chocolate"]},{name:"Chamonix",keywords:["mountain","ski","alps"]},{name:"Berlin",keywords:["wall","brandenburg","modern"]},{name:"Rome",keywords:["colosseum","pasta","history"]},{name:"Paris",keywords:["eiffel","croissant","louvre"]}].map(((e,t)=>{return{id:`city-${t+1}`,name:e.name,description:(n=e.name,{Amsterdam:"Город каналов и свободы, где каждый найдет что-то по душе - от музеев до ночных клубов.",Geneva:"Строгая элегантность Швейцарии в сочетании с живописными видами на озеро и горы.",Chamonix:"Рай для альпинистов и лыжников с потрясающими горными пейзажами.",Berlin:"Контрастный город, где бурная ночная жизнь соседствует с памятниками истории.",Rome:"Каждый камень здесь дышит историей, а воздух пропитан ароматом свежей пасты.",Paris:"Романтичная столица Франции, где искусство встречается с гастрономией."}[n]||`${n} — прекрасный город для путешествий.`),pictures:Array.from({length:3},((n,s)=>{return{src:`https://loremflickr.com/248/152/${e.name.toLowerCase()},${e.keywords[s]}?random=${t}${s}`,description:(i=e.name,r=e.keywords[s],`${i}: ${{canal:"Живописный канал в центре города",bikes:"Типичная улица с велосипедами",museum:"Один из знаменитых музеев",lake:"Вид на озеро с набережной",fountain:"Знаменитый городской фонтан",chocolate:"Местные шоколадные деликатесы",mountain:"Величественные горные вершины",ski:"Горнолыжные трассы курорта",alps:"Панорама Альпийских гор",wall:"Исторический памятник архитектуры",brandenburg:"Символ города - Бранденбургские ворота",modern:"Современный архитектурный ансамбль",colosseum:"Древний амфитеатр - свидетель истории",pasta:"Традиционное итальянское блюдо",history:"Улицы, хранящие многовековую историю",eiffel:"Главная достопримечательность города",croissant:"Свежая выпечка в местной булочной",louvre:"Знаменитый музей искусств"}[r]||"Красивый вид города"}`)};var i,r}))};var n})),q=Object.entries({taxi:["Повысить класс","Детское кресло"],bus:["Кондиционер","Wi-Fi"],train:["Купе","Обед"],ship:["Каюта","Экскурсия"],drive:["Полный бак","Страховка"],flight:["Бизнес-класс","Доп. багаж"],"check-in":["Завтрак","Улучшенный номер"],sightseeing:["Гид","Фотосессия"],restaurant:["Дегустация","Вино"]}).map((e=>{let[t,n]=e;return{type:t,offers:n.map(((e,t)=>({id:t+1,title:e,price:Math.floor(100*Math.random())+10})))}})),j=((e,t)=>{const n=["taxi","bus","train","ship","drive","flight","check-in","sightseeing","restaurant"];return Array.from({length:15},((e,s)=>{const i=(()=>{const e=new Date,t=new Date(e.getTime()-2592e6),n=new Date(e.getTime()+2592e6);return new Date(t.getTime()+Math.random()*(n-t))})(),r=new Date(i.getTime()+48*Math.random()*60*60*1e3);return{id:s+1,type:n[Math.floor(Math.random()*n.length)],destination:t[Math.floor(Math.random()*t.length)].id,dateFrom:i.toISOString(),dateTo:r.toISOString(),basePrice:Math.floor(500*Math.random())+50,offers:Array.from({length:Math.floor(3*Math.random())},((e,t)=>t+1)),isFavorite:Math.random()>.7}}))})(0,P);document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".trip-main"),t=document.querySelector(".trip-events");if(!e||!t)return;const n=new N,s=new O,i=new I;n.setDestinations(P),s.setOffers(q),i.setEvents(j),i.setDestinationsModel(n),i.setOffersModel(s),new B({eventsContainer:t,mainContainer:e},i,n,s).init()}))}()}();
//# sourceMappingURL=main.a855979779f8bd577a42.js.map